<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/build.gradle">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/build.gradle" />
              <option name="originalContent" value="plugins {&#10;    id (&quot;com.chaquo.python&quot;)&#10;    id (&quot;com.android.application&quot;)&#10;    id (&quot;org.jetbrains.kotlin.android&quot;)&#10;    alias(libs.plugins.google.gms.google.services)&#10;    alias(libs.plugins.google.firebase.crashlytics)&#10;}&#10;&#10;chaquopy {&#10;    defaultConfig {}&#10;    productFlavors { }&#10;    sourceSets { }&#10;}&#10;&#10;android {&#10;    namespace 'com.example.calculadoraimc'&#10;    compileSdk 36&#10;&#10;    defaultConfig {&#10;        applicationId &quot;com.allesterdev.imcpractico&quot;&#10;        minSdk 28&#10;        targetSdk 36&#10;        versionCode 4&#10;        versionName &quot;1.0.3&quot;&#10;&#10;        ndk {&#10;            abiFilters &quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;&#10;        }&#10;&#10;        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;&#10;        // Configuración de Python en Chaquopy&#10;        python {&#10;            version &quot;3.10&quot; //&#10;            pip {&#10;                install &quot;pandas&quot;&#10;&#10;            }&#10;        }&#10;    }&#10;&#10;    buildTypes {&#10;        debug {&#10;            buildConfigField &quot;boolean&quot;, &quot;DEBUG_LOGS&quot;, &quot;true&quot;&#10;            // IDs de prueba oficiales de Google AdMob para testing&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_APP_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544~3347511713\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_INTERSTITIAL_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/1033173712\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_ADULTOS_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/2247696110\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_MENORES_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/2247696110\&quot;&quot;&#10;            manifestPlaceholders = [admobAppId: &quot;ca-app-pub-3940256099942544~3347511713&quot;]&#10;            // Removed applicationIdSuffix &quot;.debug&quot;&#10;        }&#10;        release {&#10;            buildConfigField &quot;boolean&quot;, &quot;DEBUG_LOGS&quot;, &quot;false&quot;&#10;            // IDs reales de producción&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_APP_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187~8423151311\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_INTERSTITIAL_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/4318619265\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_ADULTOS_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/5625522573\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_MENORES_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/2999359230\&quot;&quot;&#10;            manifestPlaceholders = [admobAppId: &quot;ca-app-pub-3183197075562187~8423151311&quot;]&#10;            minifyEnabled true&#10;            shrinkResources true&#10;            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'&#10;        }&#10;    }&#10;&#10;    compileOptions {&#10;        sourceCompatibility JavaVersion.VERSION_11&#10;        targetCompatibility JavaVersion.VERSION_11&#10;    }&#10;&#10;    kotlinOptions {&#10;        jvmTarget = '11'&#10;    }&#10;&#10;    buildFeatures {&#10;        viewBinding true&#10;        buildConfig true&#10;    }&#10;&#10;    ndkVersion '29.0.13599879 rc2'&#10;    buildToolsVersion '34.0.0'&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation platform(&quot;com.google.firebase:firebase-bom:34.2.0&quot;)&#10;    implementation &quot;com.google.firebase:firebase-analytics&quot;&#10;    implementation &quot;com.google.firebase:firebase-crashlytics&quot;&#10;    implementation &quot;com.google.android.gms:play-services-ads:24.6.0&quot;&#10;    implementation(&quot;com.google.android.ump:user-messaging-platform:3.1.0&quot;)&#10;&#10;&#10;&#10;    implementation 'androidx.core:core:1.16.0'&#10;    implementation libs.androidx.core.splashscreen&#10;    implementation libs.androidx.core.ktx.v1101&#10;    implementation libs.androidx.appcompat&#10;    implementation libs.material&#10;    implementation libs.androidx.constraintlayout&#10;    implementation libs.androidx.lifecycle.livedata.ktx&#10;    implementation libs.androidx.lifecycle.viewmodel.ktx&#10;    implementation libs.androidx.navigation.fragment.ktx&#10;    implementation libs.androidx.navigation.ui.ktx&#10;    testImplementation libs.junit&#10;    androidTestImplementation libs.androidx.junit&#10;    androidTestImplementation libs.androidx.espresso.core&#10;    implementation 'com.github.PhilJay:MPAndroidChart:3.1.0'&#10;}" />
              <option name="updatedContent" value="plugins {&#10;    id (&quot;com.chaquo.python&quot;)&#10;    id (&quot;com.android.application&quot;)&#10;    id (&quot;org.jetbrains.kotlin.android&quot;)&#10;    alias(libs.plugins.google.gms.google.services)&#10;    alias(libs.plugins.google.firebase.crashlytics)&#10;}&#10;&#10;chaquopy {&#10;    defaultConfig {}&#10;    productFlavors { }&#10;    sourceSets { }&#10;}&#10;&#10;android {&#10;    namespace 'com.example.calculadoraimc'&#10;    compileSdk 36&#10;&#10;    defaultConfig {&#10;        applicationId &quot;com.allesterdev.imcpractico&quot;&#10;        minSdk 28&#10;        targetSdk 36&#10;        versionCode 4&#10;        versionName &quot;1.0.3&quot;&#10;&#10;        ndk {&#10;            abiFilters &quot;armeabi-v7a&quot;, &quot;arm64-v8a&quot;, &quot;x86&quot;, &quot;x86_64&quot;&#10;        }&#10;&#10;        testInstrumentationRunner &quot;androidx.test.runner.AndroidJUnitRunner&quot;&#10;&#10;        // Configuración de Python en Chaquopy&#10;        python {&#10;            version &quot;3.10&quot; //&#10;            pip {&#10;                install &quot;pandas&quot;&#10;&#10;            }&#10;        }&#10;    }&#10;&#10;    buildTypes {&#10;        debug {&#10;            buildConfigField &quot;boolean&quot;, &quot;DEBUG_LOGS&quot;, &quot;true&quot;&#10;            // IDs de prueba oficiales de Google AdMob para testing&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_APP_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544~3347511713\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_INTERSTITIAL_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/1033173712\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_ADULTOS_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/2247696110\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_MENORES_ID&quot;, &quot;\&quot;ca-app-pub-3940256099942544/2247696110\&quot;&quot;&#10;            manifestPlaceholders = [admobAppId: &quot;ca-app-pub-3940256099942544~3347511713&quot;]&#10;            // Removed applicationIdSuffix &quot;.debug&quot;&#10;        }&#10;        release {&#10;            buildConfigField &quot;boolean&quot;, &quot;DEBUG_LOGS&quot;, &quot;false&quot;&#10;            // IDs reales de producción&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_APP_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187~8423151311\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_INTERSTITIAL_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/4318619265\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_ADULTOS_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/5625522573\&quot;&quot;&#10;            buildConfigField &quot;String&quot;, &quot;ADMOB_NATIVE_MENORES_ID&quot;, &quot;\&quot;ca-app-pub-3183197075562187/2999359230\&quot;&quot;&#10;            manifestPlaceholders = [admobAppId: &quot;ca-app-pub-3183197075562187~8423151311&quot;]&#10;            minifyEnabled true&#10;            shrinkResources true&#10;            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'&#10;        }&#10;    }&#10;&#10;    compileOptions {&#10;        sourceCompatibility JavaVersion.VERSION_11&#10;        targetCompatibility JavaVersion.VERSION_11&#10;    }&#10;&#10;    kotlinOptions {&#10;        jvmTarget = '11'&#10;    }&#10;&#10;    buildFeatures {&#10;        viewBinding true&#10;        buildConfig true&#10;    }&#10;&#10;    ndkVersion '29.0.13599879 rc2'&#10;    buildToolsVersion '34.0.0'&#10;}&#10;&#10;dependencies {&#10;&#10;    implementation platform(&quot;com.google.firebase:firebase-bom:34.2.0&quot;)&#10;    implementation &quot;com.google.firebase:firebase-analytics&quot;&#10;    implementation &quot;com.google.firebase:firebase-crashlytics&quot;&#10;    implementation &quot;com.google.android.gms:play-services-ads:24.6.0&quot;&#10;    implementation(&quot;com.google.android.ump:user-messaging-platform:3.1.0&quot;)&#10;&#10;    implementation 'androidx.activity:activity-ktx:1.9.3'&#10;    implementation 'androidx.core:core:1.16.0'&#10;    implementation libs.androidx.core.splashscreen&#10;    implementation libs.androidx.core.ktx.v1101&#10;    implementation libs.androidx.appcompat&#10;    implementation libs.material&#10;    implementation libs.androidx.constraintlayout&#10;    implementation libs.androidx.lifecycle.livedata.ktx&#10;    implementation libs.androidx.lifecycle.viewmodel.ktx&#10;    implementation libs.androidx.navigation.fragment.ktx&#10;    implementation libs.androidx.navigation.ui.ktx&#10;    testImplementation libs.junit&#10;    androidTestImplementation libs.androidx.junit&#10;    androidTestImplementation libs.androidx.espresso.core&#10;    implementation 'com.github.PhilJay:MPAndroidChart:3.1.0'&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/MainActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/MainActivity.kt" />
              <option name="originalContent" value="package com.example.calculadoraimc&#10;&#10;import android.content.SharedPreferences&#10;import android.os.Bundle&#10;import androidx.core.splashscreen.SplashScreen.Companion.installSplashScreen&#10;import com.google.android.material.bottomnavigation.BottomNavigationView&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.appcompat.app.AppCompatDelegate&#10;import androidx.navigation.findNavController&#10;import com.example.calculadoraimc.databinding.ActivityMainBinding&#10;import androidx.navigation.ui.setupWithNavController&#10;import androidx.appcompat.app.AlertDialog&#10;import android.graphics.Rect&#10;import android.view.ViewTreeObserver&#10;import com.google.firebase.analytics.FirebaseAnalytics&#10;import androidx.navigation.NavController&#10;import com.google.firebase.crashlytics.FirebaseCrashlytics&#10;import com.google.android.gms.ads.MobileAds&#10;import com.google.android.ump.*&#10;import com.example.calculadoraimc.ui.adultos.AdultosFragment&#10;import com.example.calculadoraimc.ui.menores.MenoresFragment&#10;import androidx.navigation.fragment.NavHostFragment&#10;import androidx.core.content.edit&#10;&#10;class MainActivity : AppCompatActivity() {&#10;&#10;    companion object {&#10;        private const val SPLASH_DURATION_MS = 1400L&#10;        private const val OVERLAY_FADE_MS = 600L&#10;    }&#10;&#10;    private lateinit var binding: ActivityMainBinding&#10;    private lateinit var sharedPreferences: SharedPreferences&#10;    private var disclaimerPending = false&#10;    private var keyboardLayoutListener: ViewTreeObserver.OnGlobalLayoutListener? = null&#10;    private lateinit var firebaseAnalytics: FirebaseAnalytics&#10;    private lateinit var crashlytics: FirebaseCrashlytics&#10;    private lateinit var navController: NavController&#10;    private lateinit var consentInformation: ConsentInformation&#10;&#10;    private var isUiReady = false&#10;    private var isAppReady = false&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)&#10;&#10;        val splashScreen = installSplashScreen()&#10;        splashScreen.setKeepOnScreenCondition { !isUiReady }&#10;&#10;        super.onCreate(savedInstanceState)&#10;&#10;        binding = ActivityMainBinding.inflate(layoutInflater)&#10;        setContentView(binding.root)&#10;        supportActionBar?.hide()&#10;&#10;        isUiReady = true&#10;&#10;        firebaseAnalytics = FirebaseAnalytics.getInstance(this)&#10;        crashlytics = FirebaseCrashlytics.getInstance()&#10;        sharedPreferences = getSharedPreferences(&quot;app_preferences&quot;, MODE_PRIVATE)&#10;        disclaimerPending = !sharedPreferences.getBoolean(&quot;disclaimer_accepted&quot;, false)&#10;&#10;        try {&#10;            val userId = sharedPreferences.getString(&quot;user_id&quot;, null) ?: &quot;usuario_anónimo&quot;&#10;            crashlytics.setUserId(userId)&#10;            crashlytics.log(&quot;MainActivity onCreate - Usuario: $userId&quot;)&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;Crashlytics&quot;, &quot;Error configurando Crashlytics&quot;, e)&#10;        }&#10;&#10;        configurarParametrosAnalytics()&#10;        logScreenView(&quot;MainActivity&quot;)&#10;        registrarIdiomaDispositivo()&#10;        setupKeyboardListener()&#10;&#10;        val params = ConsentRequestParameters.Builder().setTagForUnderAgeOfConsent(false).build()&#10;        consentInformation = UserMessagingPlatform.getConsentInformation(this)&#10;        consentInformation.requestConsentInfoUpdate(&#10;            this,&#10;            params,&#10;            { UserMessagingPlatform.loadAndShowConsentFormIfRequired(this) { _ -&gt; onConsentFlowComplete() } },&#10;            { onConsentFlowComplete() }&#10;        )&#10;    }&#10;&#10;    private fun onConsentFlowComplete() {&#10;        if (disclaimerPending) {&#10;            mostrarDisclaimer()&#10;        } else {&#10;            inicializarAdMobYContinuar()&#10;        }&#10;    }&#10;&#10;    private fun inicializarAdMobYContinuar() {&#10;        MobileAds.initialize(this) {&#10;            setAppReady()&#10;        }&#10;    }&#10;&#10;    private fun setAppReady() {&#10;        navController = findNavController(R.id.nav_host_fragment_activity_main)&#10;        val navView: BottomNavigationView = binding.navView&#10;        navView.setupWithNavController(navController)&#10;        configurarRastreoNavegacion()&#10;        com.example.calculadoraimc.utils.AdManager.getInstance(this).startAdLoading()&#10;&#10;        isAppReady = true&#10;    }&#10;&#10;    private fun mostrarDisclaimer() {&#10;        firebaseAnalytics.logEvent(&quot;disclaimer_shown&quot;, null)&#10;&#10;        val dialog = AlertDialog.Builder(this, R.style.AppAlertDialogTheme)&#10;            .setTitle(getString(R.string.disclaimer_titulo))&#10;            .setMessage(getString(R.string.disclaimer_texto))&#10;            .setPositiveButton(getString(R.string.btn_aceptar)) { _, _ -&gt;&#10;                sharedPreferences.edit { putBoolean(&quot;disclaimer_accepted&quot;, true) }&#10;                firebaseAnalytics.logEvent(&quot;disclaimer_accepted&quot;, null)&#10;                inicializarAdMobYContinuar()&#10;            }&#10;            .setCancelable(false)&#10;            .create()&#10;&#10;        dialog.show()&#10;    }&#10;&#10;    private fun logScreenView(screenName: String, screenClass: String? = null) {&#10;        val params = Bundle().apply {&#10;            putString(FirebaseAnalytics.Param.SCREEN_NAME, screenName)&#10;            screenClass?.let {&#10;                putString(FirebaseAnalytics.Param.SCREEN_CLASS, it)&#10;            }&#10;        }&#10;        firebaseAnalytics.logEvent(FirebaseAnalytics.Event.SCREEN_VIEW, params)&#10;    }&#10;&#10;    private fun configurarParametrosAnalytics() {&#10;        try {&#10;            val pInfo = packageManager.getPackageInfo(packageName, 0)&#10;            val versionName = pInfo.versionName&#10;            val versionCode = if (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.P) {&#10;                pInfo.longVersionCode&#10;            } else {&#10;                @Suppress(&quot;DEPRECATION&quot;)&#10;                pInfo.versionCode.toLong()&#10;            }&#10;            val defaultParams = Bundle().apply {&#10;                putString(&quot;app_version_name&quot;, versionName)&#10;                putLong(&quot;app_version_code&quot;, versionCode)&#10;            }&#10;            firebaseAnalytics.setDefaultEventParameters(defaultParams)&#10;            firebaseAnalytics.setUserProperty(&quot;app_version&quot;, versionName)&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;Analytics&quot;, &quot;Error al obtener información de versión&quot;, e)&#10;        }&#10;    }&#10;&#10;    private fun configurarRastreoNavegacion() {&#10;        var lastMainTabId = -1&#10;        navController.addOnDestinationChangedListener { _, destination, _ -&gt;&#10;            val screenName = when (destination.id) {&#10;                R.id.navigation_adultos -&gt; &quot;Adultos&quot;&#10;                R.id.navigation_menores -&gt; &quot;Menores&quot;&#10;                R.id.navigation_historial -&gt; &quot;Historial&quot;&#10;                R.id.navigation_opciones -&gt; &quot;Opciones&quot;&#10;                else -&gt; null&#10;            }&#10;            screenName?.let { logScreenView(it) }&#10;&#10;            val mainTabIds = listOf(R.id.navigation_adultos, R.id.navigation_menores, R.id.navigation_historial, R.id.navigation_opciones)&#10;            if (mainTabIds.contains(destination.id)) {&#10;                if (lastMainTabId != -1 &amp;&amp; lastMainTabId != destination.id) {&#10;                    if (consentInformation.canRequestAds()) {&#10;                        com.example.calculadoraimc.utils.AdManager.getInstance(this).showAdOnTabChange(this)&#10;                    }&#10;                }&#10;                lastMainTabId = destination.id&#10;            }&#10;&#10;            binding.root.post {&#10;                if (consentInformation.canRequestAds()) {&#10;                    val navHostFragment = supportFragmentManager.findFragmentById(R.id.nav_host_fragment_activity_main) as NavHostFragment&#10;                    val currentFragment = navHostFragment.childFragmentManager.primaryNavigationFragment&#10;                    if (currentFragment is AdultosFragment) {&#10;                        currentFragment.cargarAnuncios()&#10;                    } else if (currentFragment is MenoresFragment) {&#10;                        currentFragment.cargarAnuncios()&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun registrarIdiomaDispositivo() {&#10;        val currentLocale = resources.configuration.locales.get(0)&#10;        val idiomaCompleto = &quot;${currentLocale.language}-${currentLocale.country}&quot;&#10;        firebaseAnalytics.setUserProperty(&quot;user_language&quot;, idiomaCompleto)&#10;    }&#10;&#10;    private fun setupKeyboardListener() {&#10;        keyboardLayoutListener = ViewTreeObserver.OnGlobalLayoutListener {&#10;            val rect = Rect()&#10;            binding.root.getWindowVisibleDisplayFrame(rect)&#10;            val heightDiff = binding.root.height - (rect.bottom - rect.top)&#10;            if (heightDiff &gt; 200) {&#10;                // Teclado visible&#10;            } else {&#10;                // Teclado oculto&#10;            }&#10;        }&#10;        binding.root.viewTreeObserver.addOnGlobalLayoutListener(keyboardLayoutListener)&#10;    }&#10;&#10;    override fun onDestroy() {&#10;        super.onDestroy()&#10;        keyboardLayoutListener?.let {&#10;            binding.root.viewTreeObserver.removeOnGlobalLayoutListener(it)&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.calculadoraimc&#10;&#10;import android.content.SharedPreferences&#10;import android.os.Bundle&#10;import androidx.core.splashscreen.SplashScreen.Companion.installSplashScreen&#10;import com.google.android.material.bottomnavigation.BottomNavigationView&#10;import androidx.appcompat.app.AppCompatActivity&#10;import androidx.appcompat.app.AppCompatDelegate&#10;import androidx.navigation.findNavController&#10;import com.example.calculadoraimc.databinding.ActivityMainBinding&#10;import androidx.navigation.ui.setupWithNavController&#10;import androidx.appcompat.app.AlertDialog&#10;import android.graphics.Rect&#10;import android.view.ViewTreeObserver&#10;import com.google.firebase.analytics.FirebaseAnalytics&#10;import androidx.navigation.NavController&#10;import com.google.firebase.crashlytics.FirebaseCrashlytics&#10;import com.google.android.gms.ads.MobileAds&#10;import com.google.android.ump.*&#10;import com.example.calculadoraimc.ui.adultos.AdultosFragment&#10;import com.example.calculadoraimc.ui.menores.MenoresFragment&#10;import androidx.navigation.fragment.NavHostFragment&#10;import androidx.core.content.edit&#10;import androidx.activity.enableEdgeToEdge&#10;import androidx.core.view.ViewCompat&#10;import androidx.core.view.WindowInsetsCompat&#10;&#10;class MainActivity : AppCompatActivity() {&#10;&#10;    companion object {&#10;        private const val SPLASH_DURATION_MS = 1400L&#10;        private const val OVERLAY_FADE_MS = 600L&#10;    }&#10;&#10;    private lateinit var binding: ActivityMainBinding&#10;    private lateinit var sharedPreferences: SharedPreferences&#10;    private var disclaimerPending = false&#10;    private var keyboardLayoutListener: ViewTreeObserver.OnGlobalLayoutListener? = null&#10;    private lateinit var firebaseAnalytics: FirebaseAnalytics&#10;    private lateinit var crashlytics: FirebaseCrashlytics&#10;    private lateinit var navController: NavController&#10;    private lateinit var consentInformation: ConsentInformation&#10;&#10;    private var isUiReady = false&#10;    private var isAppReady = false&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        // Habilitar edge-to-edge para cumplir con Android 15+&#10;        enableEdgeToEdge()&#10;&#10;        AppCompatDelegate.setDefaultNightMode(AppCompatDelegate.MODE_NIGHT_NO)&#10;&#10;        val splashScreen = installSplashScreen()&#10;        splashScreen.setKeepOnScreenCondition { !isUiReady }&#10;&#10;        super.onCreate(savedInstanceState)&#10;&#10;        binding = ActivityMainBinding.inflate(layoutInflater)&#10;        setContentView(binding.root)&#10;        supportActionBar?.hide()&#10;&#10;        // Configurar manejo de insets del sistema para edge-to-edge&#10;        setupEdgeToEdgeInsets()&#10;&#10;        isUiReady = true&#10;&#10;        firebaseAnalytics = FirebaseAnalytics.getInstance(this)&#10;        crashlytics = FirebaseCrashlytics.getInstance()&#10;        sharedPreferences = getSharedPreferences(&quot;app_preferences&quot;, MODE_PRIVATE)&#10;        disclaimerPending = !sharedPreferences.getBoolean(&quot;disclaimer_accepted&quot;, false)&#10;&#10;        try {&#10;            val userId = sharedPreferences.getString(&quot;user_id&quot;, null) ?: &quot;usuario_anónimo&quot;&#10;            crashlytics.setUserId(userId)&#10;            crashlytics.log(&quot;MainActivity onCreate - Usuario: $userId&quot;)&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;Crashlytics&quot;, &quot;Error configurando Crashlytics&quot;, e)&#10;        }&#10;&#10;        configurarParametrosAnalytics()&#10;        logScreenView(&quot;MainActivity&quot;)&#10;        registrarIdiomaDispositivo()&#10;        setupKeyboardListener()&#10;&#10;        val params = ConsentRequestParameters.Builder().setTagForUnderAgeOfConsent(false).build()&#10;        consentInformation = UserMessagingPlatform.getConsentInformation(this)&#10;        consentInformation.requestConsentInfoUpdate(&#10;            this,&#10;            params,&#10;            { UserMessagingPlatform.loadAndShowConsentFormIfRequired(this) { _ -&gt; onConsentFlowComplete() } },&#10;            { onConsentFlowComplete() }&#10;        )&#10;    }&#10;&#10;    private fun onConsentFlowComplete() {&#10;        if (disclaimerPending) {&#10;            mostrarDisclaimer()&#10;        } else {&#10;            inicializarAdMobYContinuar()&#10;        }&#10;    }&#10;&#10;    private fun inicializarAdMobYContinuar() {&#10;        MobileAds.initialize(this) {&#10;            setAppReady()&#10;        }&#10;    }&#10;&#10;    private fun setAppReady() {&#10;        navController = findNavController(R.id.nav_host_fragment_activity_main)&#10;        val navView: BottomNavigationView = binding.navView&#10;        navView.setupWithNavController(navController)&#10;        configurarRastreoNavegacion()&#10;        com.example.calculadoraimc.utils.AdManager.getInstance(this).startAdLoading()&#10;&#10;        isAppReady = true&#10;    }&#10;&#10;    private fun mostrarDisclaimer() {&#10;        firebaseAnalytics.logEvent(&quot;disclaimer_shown&quot;, null)&#10;&#10;        val dialog = AlertDialog.Builder(this, R.style.AppAlertDialogTheme)&#10;            .setTitle(getString(R.string.disclaimer_titulo))&#10;            .setMessage(getString(R.string.disclaimer_texto))&#10;            .setPositiveButton(getString(R.string.btn_aceptar)) { _, _ -&gt;&#10;                sharedPreferences.edit { putBoolean(&quot;disclaimer_accepted&quot;, true) }&#10;                firebaseAnalytics.logEvent(&quot;disclaimer_accepted&quot;, null)&#10;                inicializarAdMobYContinuar()&#10;            }&#10;            .setCancelable(false)&#10;            .create()&#10;&#10;        dialog.show()&#10;    }&#10;&#10;    private fun logScreenView(screenName: String, screenClass: String? = null) {&#10;        val params = Bundle().apply {&#10;            putString(FirebaseAnalytics.Param.SCREEN_NAME, screenName)&#10;            screenClass?.let {&#10;                putString(FirebaseAnalytics.Param.SCREEN_CLASS, it)&#10;            }&#10;        }&#10;        firebaseAnalytics.logEvent(FirebaseAnalytics.Event.SCREEN_VIEW, params)&#10;    }&#10;&#10;    private fun configurarParametrosAnalytics() {&#10;        try {&#10;            val pInfo = packageManager.getPackageInfo(packageName, 0)&#10;            val versionName = pInfo.versionName&#10;            val versionCode = if (android.os.Build.VERSION.SDK_INT &gt;= android.os.Build.VERSION_CODES.P) {&#10;                pInfo.longVersionCode&#10;            } else {&#10;                @Suppress(&quot;DEPRECATION&quot;)&#10;                pInfo.versionCode.toLong()&#10;            }&#10;            val defaultParams = Bundle().apply {&#10;                putString(&quot;app_version_name&quot;, versionName)&#10;                putLong(&quot;app_version_code&quot;, versionCode)&#10;            }&#10;            firebaseAnalytics.setDefaultEventParameters(defaultParams)&#10;            firebaseAnalytics.setUserProperty(&quot;app_version&quot;, versionName)&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;Analytics&quot;, &quot;Error al obtener información de versión&quot;, e)&#10;        }&#10;    }&#10;&#10;    private fun configurarRastreoNavegacion() {&#10;        var lastMainTabId = -1&#10;        navController.addOnDestinationChangedListener { _, destination, _ -&gt;&#10;            val screenName = when (destination.id) {&#10;                R.id.navigation_adultos -&gt; &quot;Adultos&quot;&#10;                R.id.navigation_menores -&gt; &quot;Menores&quot;&#10;                R.id.navigation_historial -&gt; &quot;Historial&quot;&#10;                R.id.navigation_opciones -&gt; &quot;Opciones&quot;&#10;                else -&gt; null&#10;            }&#10;            screenName?.let { logScreenView(it) }&#10;&#10;            val mainTabIds = listOf(R.id.navigation_adultos, R.id.navigation_menores, R.id.navigation_historial, R.id.navigation_opciones)&#10;            if (mainTabIds.contains(destination.id)) {&#10;                if (lastMainTabId != -1 &amp;&amp; lastMainTabId != destination.id) {&#10;                    if (consentInformation.canRequestAds()) {&#10;                        com.example.calculadoraimc.utils.AdManager.getInstance(this).showAdOnTabChange(this)&#10;                    }&#10;                }&#10;                lastMainTabId = destination.id&#10;            }&#10;&#10;            binding.root.post {&#10;                if (consentInformation.canRequestAds()) {&#10;                    val navHostFragment = supportFragmentManager.findFragmentById(R.id.nav_host_fragment_activity_main) as NavHostFragment&#10;                    val currentFragment = navHostFragment.childFragmentManager.primaryNavigationFragment&#10;                    if (currentFragment is AdultosFragment) {&#10;                        currentFragment.cargarAnuncios()&#10;                    } else if (currentFragment is MenoresFragment) {&#10;                        currentFragment.cargarAnuncios()&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun registrarIdiomaDispositivo() {&#10;        val currentLocale = resources.configuration.locales.get(0)&#10;        val idiomaCompleto = &quot;${currentLocale.language}-${currentLocale.country}&quot;&#10;        firebaseAnalytics.setUserProperty(&quot;user_language&quot;, idiomaCompleto)&#10;    }&#10;&#10;    private fun setupKeyboardListener() {&#10;        keyboardLayoutListener = ViewTreeObserver.OnGlobalLayoutListener {&#10;            val rect = Rect()&#10;            binding.root.getWindowVisibleDisplayFrame(rect)&#10;            val heightDiff = binding.root.height - (rect.bottom - rect.top)&#10;            if (heightDiff &gt; 200) {&#10;                // Teclado visible&#10;            } else {&#10;                // Teclado oculto&#10;            }&#10;        }&#10;        binding.root.viewTreeObserver.addOnGlobalLayoutListener(keyboardLayoutListener)&#10;    }&#10;&#10;    private fun setupEdgeToEdgeInsets() {&#10;        ViewCompat.setOnApplyWindowInsetsListener(binding.root) { view, insets -&gt;&#10;            val statusBarHeight = insets.getInsets(WindowInsetsCompat.Type.statusBars()).top&#10;            val navigationBarHeight = insets.getInsets(WindowInsetsCompat.Type.navigationBars()).bottom&#10;&#10;            view.setPadding(0, statusBarHeight, 0, navigationBarHeight)&#10;            insets&#10;        }&#10;    }&#10;&#10;    override fun onDestroy() {&#10;        super.onDestroy()&#10;        keyboardLayoutListener?.let {&#10;            binding.root.viewTreeObserver.removeOnGlobalLayoutListener(it)&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/ui/menores/MenoresFragmentFixed.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/ui/menores/MenoresFragmentFixed.kt" />
              <option name="updatedContent" value="package com.example.calculadoraimc.ui.menores&#10;&#10;import android.content.Context&#10;import android.os.Bundle&#10;import android.text.Editable&#10;import android.text.TextWatcher&#10;import android.view.LayoutInflater&#10;import android.view.View&#10;import android.view.ViewGroup&#10;import android.view.inputmethod.InputMethodManager&#10;import android.widget.Toast&#10;import androidx.fragment.app.Fragment&#10;import com.example.calculadoraimc.R&#10;import com.example.calculadoraimc.databinding.FragmentMenoresBinding&#10;import com.chaquo.python.Python&#10;import com.example.calculadoraimc.utils.MeasurementUtils&#10;import com.example.calculadoraimc.utils.MeasurementUtils.MeasurementSystem&#10;&#10;class MenoresFragment : Fragment() {&#10;&#10;    private var _binding: FragmentMenoresBinding? = null&#10;    private val binding get() = _binding!!&#10;    private lateinit var measurementSystem: MeasurementSystem&#10;&#10;    override fun onCreateView(&#10;        inflater: LayoutInflater,&#10;        container: ViewGroup?,&#10;        savedInstanceState: Bundle?&#10;    ): View {&#10;        _binding = FragmentMenoresBinding.inflate(inflater, container, false)&#10;        val root: View = binding.root&#10;&#10;        // Determinar sistema de medición según localización&#10;        measurementSystem = MeasurementUtils.getPreferredSystem(requireContext())&#10;&#10;        // Configurar etiquetas según sistema de medición&#10;        setupMeasurementLabels()&#10;&#10;        setupClickListeners()&#10;        setupTextWatchers()&#10;&#10;        return root&#10;    }&#10;&#10;    /**&#10;     * Configura los hints según el sistema de medición detectado&#10;     */&#10;    private fun setupMeasurementLabels() {&#10;        when (measurementSystem) {&#10;            MeasurementSystem.METRIC -&gt; {&#10;                // Sistema métrico (cm, kg)&#10;                binding.tilPeso.hint = getString(R.string.hint_peso)&#10;                binding.tilAltura.hint = getString(R.string.hint_altura)&#10;            }&#10;            MeasurementSystem.IMPERIAL -&gt; {&#10;                // Sistema imperial (lb, in)&#10;                binding.tilPeso.hint = getString(R.string.hint_peso_imperial)&#10;                binding.tilAltura.hint = getString(R.string.hint_altura_imperial)&#10;            }&#10;        }&#10;    }&#10;&#10;    fun showSoftKeyboard(view: View) {&#10;        if (view.requestFocus()) {&#10;            val imm = context?.getSystemService(Context.INPUT_METHOD_SERVICE) as? InputMethodManager&#10;            imm?.showSoftInput(view, InputMethodManager.SHOW_IMPLICIT)&#10;        }&#10;    }&#10;&#10;    private fun setupClickListeners() {&#10;        binding.btnCalcular.setOnClickListener {&#10;            calcularPercentil()&#10;        }&#10;&#10;        binding.btnGuardar.setOnClickListener {&#10;            guardarMedicion()&#10;        }&#10;&#10;        // Botón para mostrar/ocultar información sobre percentiles&#10;        binding.btnToggleInfo.setOnClickListener {&#10;            toggleInfoPercentiles()&#10;        }&#10;    }&#10;&#10;    private fun toggleInfoPercentiles() {&#10;        val infoTextView = binding.tvInfoPercentiles&#10;        val toggleButton = binding.btnToggleInfo&#10;&#10;        if (infoTextView.visibility == View.GONE) {&#10;            // Mostrar información&#10;            infoTextView.visibility = View.VISIBLE&#10;            toggleButton.text = getString(R.string.btn_ocultar_info)&#10;            toggleButton.setIconResource(android.R.drawable.ic_menu_close_clear_cancel)&#10;        } else {&#10;            // Ocultar información&#10;            infoTextView.visibility = View.GONE&#10;            toggleButton.text = getString(R.string.btn_mostrar_info)&#10;            toggleButton.setIconResource(android.R.drawable.ic_dialog_info)&#10;        }&#10;    }&#10;&#10;    private fun setupTextWatchers() {&#10;        // Implementación recomendada: campo único, solo dígitos, máscara según locale&#10;        val dateOrder = detectDateOrder()&#10;        val watcher = object : TextWatcher {&#10;            var selfChange = false&#10;&#10;            override fun beforeTextChanged(s: CharSequence?, start: Int, count: Int, after: Int) {}&#10;&#10;            override fun onTextChanged(s: CharSequence?, start: Int, before: Int, count: Int) {}&#10;&#10;            override fun afterTextChanged(s: Editable?) {&#10;                if (selfChange) return&#10;                val original = s?.toString() ?: &quot;&quot;&#10;                val digits = original.replace(Regex(&quot;[^0-9]&quot;), &quot;&quot;)&#10;&#10;                // Limitar a 8 dígitos (DDMMYYYY / MMDDYYYY / YYYYMMDD)&#10;                val maxDigits = 8&#10;                val limited = if (digits.length &gt; maxDigits) digits.substring(0, maxDigits) else digits&#10;&#10;                val formatted = formatDigitsAsDate(limited, dateOrder)&#10;&#10;                try {&#10;                    selfChange = true&#10;                    binding.etFechaNacimiento.setText(formatted)&#10;                    binding.etFechaNacimiento.setSelection(formatted.length)&#10;                } finally {&#10;                    selfChange = false&#10;                }&#10;&#10;                // Validar cuando tengamos la longitud esperada&#10;                val expectedDigits = 8&#10;                if (limited.length == expectedDigits) {&#10;                    val pattern = patternWithSeparators(dateOrder)&#10;                    val sdf = java.text.SimpleDateFormat(pattern, java.util.Locale.getDefault())&#10;                    sdf.isLenient = false&#10;                    try {&#10;                        sdf.parse(formatted)&#10;                        binding.tilFechaNacimiento.error = null&#10;                        hideKeyboard(binding.etFechaNacimiento)&#10;                        binding.etFechaNacimiento.clearFocus()&#10;                    } catch (e: Exception) {&#10;                        binding.tilFechaNacimiento.error = getString(R.string.error_fecha_invalida)&#10;                    }&#10;                } else {&#10;                    binding.tilFechaNacimiento.error = null&#10;                }&#10;            }&#10;        }&#10;&#10;        binding.etFechaNacimiento.addTextChangedListener(watcher)&#10;    }&#10;&#10;    private fun hideKeyboard(view: View) {&#10;        val imm = context?.getSystemService(Context.INPUT_METHOD_SERVICE) as InputMethodManager&#10;        imm.hideSoftInputFromWindow(view.windowToken, 0)&#10;    }&#10;&#10;    // Detecta orden preferido: &quot;DMY&quot;, &quot;MDY&quot; o &quot;YMD&quot;&#10;    private fun detectDateOrder(): String {&#10;        return try {&#10;            val best = android.text.format.DateFormat.getBestDateTimePattern(java.util.Locale.getDefault(), &quot;yMd&quot;)&#10;            val lower = best.lowercase(java.util.Locale.getDefault())&#10;            val dIndex = lower.indexOf('d')&#10;            val mIndex = lower.indexOf('M')&#10;            val yIndex = lower.indexOf('y')&#10;            if (dIndex &gt;= 0 &amp;&amp; mIndex &gt;= 0 &amp;&amp; dIndex &lt; mIndex) {&#10;                &quot;DMY&quot;&#10;            } else if (mIndex &gt;= 0 &amp;&amp; dIndex &gt;= 0 &amp;&amp; mIndex &lt; dIndex) {&#10;                &quot;MDY&quot;&#10;            } else if (yIndex &gt;= 0 &amp;&amp; yIndex &lt; Math.min(dIndex.takeIf { it&gt;=0 } ?: Int.MAX_VALUE, mIndex.takeIf { it&gt;=0 } ?: Int.MAX_VALUE)) {&#10;                &quot;YMD&quot;&#10;            } else {&#10;                &quot;DMY&quot;&#10;            }&#10;        } catch (_: Exception) {&#10;            &quot;DMY&quot;&#10;        }&#10;    }&#10;&#10;    private fun formatDigitsAsDate(digits: String, order: String): String {&#10;        when (order) {&#10;            &quot;DMY&quot; -&gt; {&#10;                val sb = StringBuilder()&#10;                if (digits.length &gt;= 2) sb.append(digits.substring(0, 2)) else sb.append(digits)&#10;                if (digits.length &gt; 2) sb.append('/').append(if (digits.length &gt;= 4) digits.substring(2, 4) else digits.substring(2))&#10;                if (digits.length &gt; 4) sb.append('/').append(digits.substring(4))&#10;                return sb.toString()&#10;            }&#10;            &quot;MDY&quot; -&gt; {&#10;                val sb = StringBuilder()&#10;                if (digits.length &gt;= 2) sb.append(digits.substring(0, 2)) else sb.append(digits)&#10;                if (digits.length &gt; 2) sb.append('/').append(if (digits.length &gt;= 4) digits.substring(2, 4) else digits.substring(2))&#10;                if (digits.length &gt; 4) sb.append('/').append(digits.substring(4))&#10;                return sb.toString()&#10;            }&#10;            &quot;YMD&quot; -&gt; {&#10;                val sb = StringBuilder()&#10;                if (digits.length &gt;= 4) sb.append(digits.substring(0, 4)) else sb.append(digits)&#10;                if (digits.length &gt; 4) sb.append('/').append(if (digits.length &gt;= 6) digits.substring(4, 6) else digits.substring(4))&#10;                if (digits.length &gt; 6) sb.append('/').append(digits.substring(6))&#10;                return sb.toString()&#10;            }&#10;        }&#10;        return digits&#10;    }&#10;&#10;    private fun patternWithSeparators(order: String): String {&#10;        return when (order) {&#10;            &quot;DMY&quot; -&gt; &quot;dd/MM/yyyy&quot;&#10;            &quot;MDY&quot; -&gt; &quot;MM/dd/yyyy&quot;&#10;            &quot;YMD&quot; -&gt; &quot;yyyy/MM/dd&quot;&#10;            else -&gt; &quot;dd/MM/yyyy&quot;&#10;        }&#10;    }&#10;&#10;    private fun calcularPercentil() {&#10;        val pesoText = binding.etPeso.text.toString()&#10;        val alturaText = binding.etAltura.text.toString()&#10;        val fechaNacimiento = binding.etFechaNacimiento.text.toString()&#10;&#10;        if (pesoText.isEmpty() || alturaText.isEmpty() || fechaNacimiento.isEmpty()) {&#10;            Toast.makeText(context, getString(R.string.error_campos_vacios_menores), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        // Validar fecha localmente: formato, año de 4 dígitos, no futura y rango 5-19 años&#10;        val order = detectDateOrder()&#10;        val pattern = patternWithSeparators(order)&#10;        val sdf = java.text.SimpleDateFormat(pattern, java.util.Locale.getDefault())&#10;        sdf.isLenient = false&#10;        val dobDate = try {&#10;            // Aceptamos la fecha formateada con separadores (dd/MM/yyyy etc.)&#10;            val parsed = sdf.parse(fechaNacimiento)&#10;            parsed&#10;        } catch (e: Exception) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_fecha_invalida)&#10;            Toast.makeText(context, getString(R.string.error_fecha_invalida), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        // Comprobar fecha futura&#10;        val today = java.util.Calendar.getInstance()&#10;        val dobCal = java.util.Calendar.getInstance().apply { time = dobDate }&#10;        if (dobCal.after(today)) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_fecha_invalida)&#10;            Toast.makeText(context, getString(R.string.error_fecha_invalida), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        // Calcular edad en años&#10;        var ageYears = today.get(java.util.Calendar.YEAR) - dobCal.get(java.util.Calendar.YEAR)&#10;        val todayMonth = today.get(java.util.Calendar.MONTH)&#10;        val dobMonth = dobCal.get(java.util.Calendar.MONTH)&#10;        val todayDay = today.get(java.util.Calendar.DAY_OF_MONTH)&#10;        val dobDay = dobCal.get(java.util.Calendar.DAY_OF_MONTH)&#10;        if (todayMonth &lt; dobMonth || (todayMonth == dobMonth &amp;&amp; todayDay &lt; dobDay)) {&#10;            ageYears -= 1&#10;        }&#10;&#10;        if (ageYears &lt; 5 || ageYears &gt; 19) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_edad_rango)&#10;            Toast.makeText(context, getString(R.string.error_edad_rango), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        try {&#10;            val sexo = if (binding.rbMasculino.isChecked) &quot;Masculino&quot; else &quot;Femenino&quot;&#10;&#10;            // Convertir valores al sistema métrico si es necesario&#10;            val (pesoKg, alturaCm) = when (measurementSystem) {&#10;                MeasurementSystem.METRIC -&gt; {&#10;                    // Ya están en kg y cm, no necesita conversión&#10;                    Pair(pesoText.toFloat(), alturaText.toFloat())&#10;                }&#10;                MeasurementSystem.IMPERIAL -&gt; {&#10;                    // Convertir de libras a kg y de pulgadas a cm&#10;                    val pesoLbs = pesoText.toFloat()&#10;                    val alturaInches = alturaText.toFloat()&#10;&#10;                    val pesoKg = MeasurementUtils.lbsToKg(pesoLbs)&#10;                    val alturaCm = MeasurementUtils.inchesToCm(alturaInches)&#10;&#10;                    Pair(pesoKg, alturaCm)&#10;                }&#10;            }&#10;&#10;            // Debug: Mostrar qué datos estamos enviando&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;Enviando a Python:&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Sexo: $sexo&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Fecha: '$fechaNacimiento'&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Peso (convertido a kg): '$pesoKg'&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Altura (convertida a cm): '$alturaCm'&quot;)&#10;&#10;            // Llamar a la función de Python que usa fecha de nacimiento&#10;            val python = Python.getInstance()&#10;            val funcionesModule = python.getModule(&quot;funciones_imc_android&quot;)&#10;&#10;            // Python maneja la validación y conversión de fecha automáticamente&#10;            // Enviamos los valores ya convertidos a sistema métrico&#10;            val resultado = funcionesModule.callAttr(&quot;calcular_imc_menor_por_fecha&quot;, sexo, fechaNacimiento, pesoKg.toString(), alturaCm.toString())&#10;&#10;            // Debug: Mostrar qué devuelve Python&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;Resultado Python completo: $resultado&quot;)&#10;&#10;            // Verificar si hay error en el resultado&#10;            if (resultado.containsKey(&quot;error&quot;)) {&#10;                val error = resultado[&quot;error&quot;]?.toString() ?: &quot;Error desconocido&quot;&#10;                android.util.Log.e(&quot;MenoresFragment&quot;, &quot;Error de Python: $error&quot;)&#10;                Toast.makeText(context, getString(R.string.error_percentiles, error), Toast.LENGTH_LONG).show()&#10;                return&#10;            }&#10;&#10;            // Extraer valores usando el método correcto para objetos Python en Chaquopy&#10;            val imc = resultado.callAttr(&quot;get&quot;, &quot;imc&quot;)?.toDouble() ?: 0.0&#10;            val percentil = resultado.callAttr(&quot;get&quot;, &quot;percentil&quot;)?.toDouble() ?: 0.0&#10;            // La función Python interpretar_percentil ahora devuelve una clave de recurso.&#10;            val interpretacionKey = resultado.callAttr(&quot;get&quot;, &quot;interpretacion&quot;)?.toString() ?: &quot;&quot;&#10;            val edadAnios = resultado.callAttr(&quot;get&quot;, &quot;edad_años&quot;)?.toDouble() ?: 0.0&#10;&#10;            // Debug: Mostrar valores extraídos&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;Valores extraídos:&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  IMC: $imc&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Percentil: $percentil&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Interpretación clave: '$interpretacionKey'&quot;)&#10;            android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Edad años: $edadAnios&quot;)&#10;&#10;            // Mostrar resultados (incluyendo edad calculada)&#10;            binding.tvImcValor.text = getString(R.string.formato_imc, imc)&#10;            binding.tvPercentil.text = getString(R.string.formato_percentil, percentil)&#10;            val interpretacionTexto = when (interpretacionKey) {&#10;                &quot;interpretacion_bajo_peso&quot; -&gt; getString(R.string.interpretacion_bajo_peso)&#10;                &quot;interpretacion_peso_saludable&quot; -&gt; getString(R.string.interpretacion_peso_saludable)&#10;                &quot;interpretacion_sobrepeso&quot; -&gt; getString(R.string.interpretacion_sobrepeso)&#10;                &quot;interpretacion_obesidad&quot; -&gt; getString(R.string.interpretacion_obesidad)&#10;                &quot;&quot; -&gt; getString(R.string.sin_interpretacion)&#10;                else -&gt; {&#10;                    // Python devolvió una clave inesperada: registrar y usar el texto por defecto&#10;                    android.util.Log.w(&quot;MenoresFragment&quot;, &quot;Clave de interpretación desconocida recibida de Python: $interpretacionKey&quot;)&#10;                    getString(R.string.sin_interpretacion)&#10;                }&#10;            }&#10;&#10;            binding.tvInterpretacion.text = getString(R.string.interpretacion_con_edad, interpretacionTexto, edadAnios)&#10;&#10;            // Mostrar y actualizar la barra de percentiles&#10;            binding.barraPercentilMenores.setPercentil(percentil)&#10;            binding.barraPercentilMenores.visibility = View.VISIBLE&#10;&#10;            binding.cardResultado.visibility = View.VISIBLE&#10;&#10;            // Auto-scroll para mostrar los resultados y el botón de guardar&#10;            binding.root.post {&#10;                binding.root.smoothScrollTo(0, binding.cardResultado.bottom)&#10;            }&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;MenoresFragment&quot;, &quot;Excepción en calcularPercentil&quot;, e)&#10;            Toast.makeText(context, getString(R.string.error_calculo, e.message ?: &quot;&quot;), Toast.LENGTH_SHORT).show()&#10;        }&#10;    }&#10;&#10;    private fun guardarMedicion() {&#10;        val pesoText = binding.etPeso.text.toString()&#10;        val alturaText = binding.etAltura.text.toString()&#10;        val fechaNacimiento = binding.etFechaNacimiento.text.toString()&#10;&#10;        if (pesoText.isEmpty() || alturaText.isEmpty() || fechaNacimiento.isEmpty()) {&#10;            Toast.makeText(context, getString(R.string.error_calcular_primero_menores), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        // Validar fecha de nuevo antes de guardar&#10;        val orderSave = detectDateOrder()&#10;        val patternSave = patternWithSeparators(orderSave)&#10;        val sdfSave = java.text.SimpleDateFormat(patternSave, java.util.Locale.getDefault())&#10;        sdfSave.isLenient = false&#10;        val dobDateSave = try {&#10;            sdfSave.parse(fechaNacimiento)&#10;        } catch (e: Exception) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_fecha_invalida)&#10;            Toast.makeText(context, getString(R.string.error_fecha_invalida), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        val todaySave = java.util.Calendar.getInstance()&#10;        val dobCalSave = java.util.Calendar.getInstance().apply { time = dobDateSave }&#10;        if (dobCalSave.after(todaySave)) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_fecha_invalida)&#10;            Toast.makeText(context, getString(R.string.error_fecha_invalida), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        var ageYearsSave = todaySave.get(java.util.Calendar.YEAR) - dobCalSave.get(java.util.Calendar.YEAR)&#10;        if (todaySave.get(java.util.Calendar.MONTH) &lt; dobCalSave.get(java.util.Calendar.MONTH) ||&#10;            (todaySave.get(java.util.Calendar.MONTH) == dobCalSave.get(java.util.Calendar.MONTH) &amp;&amp;&#10;                    todaySave.get(java.util.Calendar.DAY_OF_MONTH) &lt; dobCalSave.get(java.util.Calendar.DAY_OF_MONTH))) {&#10;            ageYearsSave -= 1&#10;        }&#10;&#10;        if (ageYearsSave &lt; 5 || ageYearsSave &gt; 19) {&#10;            binding.tilFechaNacimiento.error = getString(R.string.error_edad_rango)&#10;            Toast.makeText(context, getString(R.string.error_edad_rango), Toast.LENGTH_SHORT).show()&#10;            return&#10;        }&#10;&#10;        try {&#10;            val sexo = if (binding.rbMasculino.isChecked) &quot;Masculino&quot; else &quot;Femenino&quot;&#10;&#10;            // Convertir valores al sistema métrico si es necesario&#10;            val (pesoKg, alturaCm) = when (measurementSystem) {&#10;                MeasurementSystem.METRIC -&gt; {&#10;                    // Ya están en kg y cm, no necesita conversión&#10;                    Pair(pesoText.toFloat(), alturaText.toFloat())&#10;                }&#10;                MeasurementSystem.IMPERIAL -&gt; {&#10;                    // Convertir de libras a kg y de pulgadas a cm&#10;                    val pesoLbs = pesoText.toFloat()&#10;                    val alturaInches = alturaText.toFloat()&#10;&#10;                    val pesoKg = MeasurementUtils.lbsToKg(pesoLbs)&#10;                    val alturaCm = MeasurementUtils.inchesToCm(alturaInches)&#10;&#10;                    Pair(pesoKg, alturaCm)&#10;                }&#10;            }&#10;&#10;            // Python maneja todas las conversiones automáticamente&#10;            val python = Python.getInstance()&#10;            val funcionesModule = python.getModule(&quot;funciones_imc_android&quot;)&#10;&#10;            // Calculamos nuevamente usando la nueva función por fecha y enviando los valores ya convertidos&#10;            val resultado = funcionesModule.callAttr(&quot;calcular_imc_menor_por_fecha&quot;, sexo, fechaNacimiento, pesoKg.toString(), alturaCm.toString())&#10;&#10;            if (resultado.containsKey(&quot;error&quot;) != true) {&#10;                // Usar la sintaxis correcta para extraer valores de objetos Python&#10;                val imc = resultado.callAttr(&quot;get&quot;, &quot;imc&quot;)?.toDouble() ?: 0.0&#10;                val percentil = resultado.callAttr(&quot;get&quot;, &quot;percentil&quot;)?.toDouble() ?: 0.0&#10;                val edadMeses = resultado.callAttr(&quot;get&quot;, &quot;edad_meses&quot;)?.toInt() ?: 0&#10;&#10;                // Log para verificar que los valores son correctos antes de guardar&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;Guardando medición:&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Peso (kg): $pesoKg&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Altura (cm): $alturaCm&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  IMC: $imc&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Sexo: $sexo&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Edad meses: $edadMeses&quot;)&#10;                android.util.Log.d(&quot;MenoresFragment&quot;, &quot;  Percentil: $percentil&quot;)&#10;&#10;                // Siempre guardamos en sistema métrico para consistencia en la base de datos&#10;                funcionesModule.callAttr(&quot;guardar_medicion&quot;, pesoKg, alturaCm, imc, sexo, edadMeses, percentil)&#10;&#10;                Toast.makeText(context, getString(R.string.exito_guardado), Toast.LENGTH_SHORT).show()&#10;&#10;                // Limpiar campos&#10;                binding.etPeso.text?.clear()&#10;                binding.etAltura.text?.clear()&#10;                binding.etFechaNacimiento.text?.clear()&#10;                binding.rbMasculino.isChecked = true&#10;                binding.cardResultado.visibility = View.GONE&#10;            }&#10;&#10;        } catch (e: Exception) {&#10;            android.util.Log.e(&quot;MenoresFragment&quot;, &quot;Error al guardar medición&quot;, e)&#10;            Toast.makeText(context, getString(R.string.error_guardar, e.message ?: &quot;&quot;), Toast.LENGTH_SHORT).show()&#10;        }&#10;    }&#10;&#10;    override fun onDestroyView() {&#10;        super.onDestroyView()&#10;        _binding = null&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/utils/AdUnitIds.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/calculadoraimc/utils/AdUnitIds.kt" />
              <option name="updatedContent" value="package com.example.calculadoraimc.utils&#10;&#10;object AdUnitIds {&#10;    const val ADULTOS_NATIVE = &quot;ca-app-pub-3940256099942544/2247696110&quot;&#10;    const val MENORES_NATIVE = &quot;ca-app-pub-3940256099942544/2247696110&quot; // Reemplaza por el ID real si tienes otro&#10;}&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/activity_main.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/activity_main.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:id=&quot;@+id/container&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:fitsSystemWindows=&quot;true&quot;&gt;&#10;&#10;    &lt;com.google.android.material.bottomnavigation.BottomNavigationView&#10;        android:id=&quot;@+id/nav_view&quot;&#10;        android:layout_width=&quot;0dp&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_marginStart=&quot;0dp&quot;&#10;        android:layout_marginEnd=&quot;0dp&quot;&#10;        android:background=&quot;@color/white&quot;&#10;        app:itemIconTint=&quot;@color/bottom_navigation_selector&quot;&#10;        app:itemTextColor=&quot;@color/bottom_navigation_selector&quot;&#10;        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;&#10;        app:layout_constraintRight_toRightOf=&quot;parent&quot;&#10;        app:menu=&quot;@menu/bottom_nav_menu&quot; /&gt;&#10;&#10;    &lt;fragment&#10;        android:id=&quot;@+id/nav_host_fragment_activity_main&quot;&#10;        android:name=&quot;androidx.navigation.fragment.NavHostFragment&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;match_parent&quot;&#10;        app:defaultNavHost=&quot;true&quot;&#10;        app:layout_constraintBottom_toTopOf=&quot;@id/nav_view&quot;&#10;        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;&#10;        app:layout_constraintRight_toRightOf=&quot;parent&quot;&#10;        app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;        app:navGraph=&quot;@navigation/mobile_navigation&quot; /&gt;&#10;&#10;&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;androidx.constraintlayout.widget.ConstraintLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:id=&quot;@+id/container&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&gt;&#10;&#10;    &lt;com.google.android.material.bottomnavigation.BottomNavigationView&#10;        android:id=&quot;@+id/nav_view&quot;&#10;        android:layout_width=&quot;0dp&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_marginStart=&quot;0dp&quot;&#10;        android:layout_marginEnd=&quot;0dp&quot;&#10;        android:background=&quot;@color/white&quot;&#10;        app:itemIconTint=&quot;@color/bottom_navigation_selector&quot;&#10;        app:itemTextColor=&quot;@color/bottom_navigation_selector&quot;&#10;        app:layout_constraintBottom_toBottomOf=&quot;parent&quot;&#10;        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;&#10;        app:layout_constraintRight_toRightOf=&quot;parent&quot;&#10;        app:menu=&quot;@menu/bottom_nav_menu&quot; /&gt;&#10;&#10;    &lt;fragment&#10;        android:id=&quot;@+id/nav_host_fragment_activity_main&quot;&#10;        android:name=&quot;androidx.navigation.fragment.NavHostFragment&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;0dp&quot;&#10;        app:defaultNavHost=&quot;true&quot;&#10;        app:layout_constraintBottom_toTopOf=&quot;@id/nav_view&quot;&#10;        app:layout_constraintLeft_toLeftOf=&quot;parent&quot;&#10;        app:layout_constraintRight_toRightOf=&quot;parent&quot;&#10;        app:layout_constraintTop_toTopOf=&quot;parent&quot;&#10;        app:navGraph=&quot;@navigation/mobile_navigation&quot; /&gt;&#10;&#10;&lt;/androidx.constraintlayout.widget.ConstraintLayout&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/anuncio_nativo_adultos.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/anuncio_nativo_adultos.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;com.google.android.gms.ads.nativead.NativeAdView xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;wrap_content&quot;&#10;    android:background=&quot;@color/input_background&quot;&gt;&#10;&#10;    &lt;LinearLayout&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_gravity=&quot;center&quot;&#10;        android:orientation=&quot;vertical&quot;&#10;        android:padding=&quot;10dp&quot;&gt;&#10;&#10;        &lt;TextView&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:text=&quot;@string/anuncio&quot;&#10;            android:textColor=&quot;@color/text_secondary&quot;&#10;            android:textSize=&quot;10sp&quot; /&gt;&#10;&#10;        &lt;LinearLayout&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:orientation=&quot;horizontal&quot;&gt;&#10;&#10;            &lt;ImageView&#10;                android:id=&quot;@+id/icon&quot;&#10;                android:layout_width=&quot;40dp&quot;&#10;                android:layout_height=&quot;40dp&quot;&#10;                android:adjustViewBounds=&quot;true&quot;&#10;                android:padding=&quot;5dp&quot; /&gt;&#10;&#10;            &lt;LinearLayout&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:orientation=&quot;vertical&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:id=&quot;@+id/headline&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:textColor=&quot;@color/white&quot;&#10;                    android:textSize=&quot;16sp&quot;&#10;                    android:textStyle=&quot;bold&quot; /&gt;&#10;&#10;                &lt;RatingBar&#10;                    android:id=&quot;@+id/stars&quot;&#10;                    style=&quot;?android:attr/ratingBarStyleSmall&quot;&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:isIndicator=&quot;true&quot;&#10;                    android:numStars=&quot;5&quot;&#10;                    android:stepSize=&quot;0.5&quot; /&gt;&#10;            &lt;/LinearLayout&gt;&#10;        &lt;/LinearLayout&gt;&#10;&#10;        &lt;LinearLayout&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:orientation=&quot;vertical&quot;&gt;&#10;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/body&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;5dp&quot;&#10;                android:textColor=&quot;@color/white&quot;&#10;                android:textSize=&quot;12sp&quot; /&gt;&#10;&#10;            &lt;FrameLayout&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;10dp&quot;&gt;&#10;&#10;                &lt;com.google.android.gms.ads.nativead.MediaView&#10;                    android:id=&quot;@+id/media_view&quot;&#10;                    android:layout_width=&quot;match_parent&quot;&#10;                    android:layout_height=&quot;120dp&quot;&#10;                    android:layout_gravity=&quot;center_horizontal&quot; /&gt;&#10;            &lt;/FrameLayout&gt;&#10;&#10;            &lt;Button&#10;                android:id=&quot;@+id/call_to_action&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;10dp&quot;&#10;                android:background=&quot;@color/green_primary&quot;&#10;                android:textColor=&quot;@color/white&quot;&#10;                android:textSize=&quot;14sp&quot; /&gt;&#10;        &lt;/LinearLayout&gt;&#10;    &lt;/LinearLayout&gt;&#10;&lt;/com.google.android.gms.ads.nativead.NativeAdView&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>